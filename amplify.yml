version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 22
        - nvm use 22
        - corepack enable
        - pnpm install
    build:
      commands:
        - echo "NODE_ENV=production" >> .env
        - echo "MAIL_PROVIDER=$MAIL_PROVIDER" >> .env
        - echo "MAIL_HOST=$MAIL_HOST" >> .env
        - echo "MAIL_PORT=$MAIL_PORT" >> .env
        - echo "MAIL_ENCRYPTION=$MAIL_ENCRYPTION" >> .env
        - echo "MAIL_USERNAME=$MAIL_USERNAME" >> .env
        - echo "MAIL_PASSWORD=$MAIL_PASSWORD" >> .env
        - echo "MAIL_FROM_ADDRESS=$MAIL_FROM_ADDRESS" >> .env
        - echo "REDIS_HOST=$REDIS_HOST" >> .env
        - echo "REDIS_PORT=$REDIS_PORT" >> .env
        - echo "REDIS_PASSWORD=$REDIS_PASSWORD" >> .env
        - echo "CACHE_TTL=$CACHE_TTL" >> .env
        - echo "CONTACT_EMAIL=$CONTACT_EMAIL" >> .env
        - echo "DEPLOY_AWS_REGION=$DEPLOY_AWS_REGION" >> .env

        - pnpm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .pnpm-store/**/*
